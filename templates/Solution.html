<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Solution Steps</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .grid { display: grid; grid-template-columns: repeat(3, 60px); gap: 6px; }
    .tile { width:60px; height:60px; border: 2px solid #ccc; box-sizing: border-box; }
    .tile img { width:100%; height:100%; object-fit:cover; display:block; }
    .controls { margin-bottom: 12px; }
    .blank { background: #f9f9f9; border: 2px dashed #bbb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Solution Path</h1>
        <p>Algorithm used: {{ algorithm }}</p>
        {% if solution_steps and solution_steps|length > 0 %}
            <div class="controls">
                <button id="prev">Prev</button>
                <button id="play">Play</button>
                <button id="next">Next</button>
                <span id="counter">Step 1 / {{ solution_steps|length }}</span>
                <a href="{{ url_for('puzzle') }}" class="button" style="margin-left:12px;">Back to puzzle</a>
            </div>
            <div id="player" data-steps='{{ solution_steps|tojson|safe }}' data-tile-map='{{ tile_map|tojson|safe }}' data-tile-base='{{ url_for('static', filename='tiles/') }}'>
                <!-- player will render a single step -->
            </div>
           <script type="text/javascript">
    function readData(el, key){
        try{ return JSON.parse(el.getAttribute(key) || 'null'); }catch(e){ return null; }
    }
    const playerEl = document.getElementById('player');
    const steps = readData(playerEl, 'data-steps') || [];
    const tileMap = readData(playerEl, 'data-tile-map') || {};
    const tileBaseUrl = playerEl.getAttribute('data-tile-base') || '/static/tiles/';

    let idx = 0;
    const player = document.getElementById('player');
    const counter = document.getElementById('counter');

    function renderStep(i){
        const step = steps[i];
        let html = '<div class="grid">';
        for(const row of step){
            for(const t of row){
                let tileClass = t === 0 ? 'tile blank' : 'tile';
                html += `<div class="${tileClass}">`;
                if(t !== 0){
                    let fname = tileMap[t];
                    if(!fname){
                        console.log('Missing tile for', t, tileMap);
                        html += `<span style="color:red;font-size:10px;">?</span>`;
                    }else{
                        html += `<img src="${tileBaseUrl}${fname}" />`;
                    }
                }
                html += '</div>';
            }
        }
        html += '</div>';
        player.innerHTML = html;
        counter.textContent = `Step ${i+1} / ${steps.length}`;
    }

    document.getElementById('prev').addEventListener('click', ()=>{ idx = Math.max(0, idx-1); renderStep(idx); });
    document.getElementById('next').addEventListener('click', ()=>{ idx = Math.min(steps.length-1, idx+1); renderStep(idx); });

    let playing = false;
    let timer = null;
    document.getElementById('play').addEventListener('click', ()=>{
        if(playing){
            clearInterval(timer);
            playing = false;
            document.getElementById('play').textContent = 'Play';
            return;
        }
        playing = true;
        document.getElementById('play').textContent = 'Pause';
        timer = setInterval(()=>{ idx = (idx+1) % steps.length; renderStep(idx); }, 600);
    });

    renderStep(0);
</script>

        {% else %}
            <p>No solution steps available.</p>
        {% endif %}
        <a href="{{ url_for('index') }}">‚Üê Try another puzzle</a>
    </div>
</body>
</html>
